<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
--><div hidden="" by-polymer-bundler=""><!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
--><!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
--><!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
--><script>

  /**
   * Use `Polymer.IronCheckedElementBehavior` to implement a custom element
   * that has a `checked` property, which can be used for validation if the
   * element is also `required`. Element instances implementing this behavior
   * will also be registered for use in an `iron-form` element.
   *
   * @demo demo/index.html
   * @polymerBehavior Polymer.IronCheckedElementBehavior
   */
  Polymer.IronCheckedElementBehaviorImpl = {

    properties: {
      /**
       * Fired when the checked state changes.
       *
       * @event iron-change
       */

      /**
       * Gets or sets the state, `true` is checked and `false` is unchecked.
       */
      checked: {
        type: Boolean,
        value: false,
        reflectToAttribute: true,
        notify: true,
        observer: '_checkedChanged'
      },

      /**
       * If true, the button toggles the active state with each tap or press
       * of the spacebar.
       */
      toggles: {
        type: Boolean,
        value: true,
        reflectToAttribute: true
      },

      /* Overriden from Polymer.IronFormElementBehavior */
      value: {
        type: String,
        value: 'on',
        observer: '_valueChanged'
      }
    },

    observers: [
      '_requiredChanged(required)'
    ],

    created: function() {
      // Used by `iron-form` to handle the case that an element with this behavior
      // doesn't have a role of 'checkbox' or 'radio', but should still only be
      // included when the form is serialized if `this.checked === true`.
      this._hasIronCheckedElementBehavior = true;
    },

    /**
     * Returns false if the element is required and not checked, and true otherwise.
     * @param {*=} _value Ignored.
     * @return {boolean} true if `required` is false or if `checked` is true.
     */
    _getValidity: function(_value) {
      return this.disabled || !this.required || this.checked;
    },

    /**
     * Update the aria-required label when `required` is changed.
     */
    _requiredChanged: function() {
      if (this.required) {
        this.setAttribute('aria-required', 'true');
      } else {
        this.removeAttribute('aria-required');
      }
    },

    /**
     * Fire `iron-changed` when the checked state changes.
     */
    _checkedChanged: function() {
      this.active = this.checked;
      this.fire('iron-change');
    },

    /**
     * Reset value to 'on' if it is set to `undefined`.
     */
    _valueChanged: function() {
      if (this.value === undefined || this.value === null) {
        this.value = 'on';
      }
    }
  };

  /** @polymerBehavior Polymer.IronCheckedElementBehavior */
  Polymer.IronCheckedElementBehavior = [
    Polymer.IronFormElementBehavior,
    Polymer.IronValidatableBehavior,
    Polymer.IronCheckedElementBehaviorImpl
  ];

</script>
<script>
  /**
   * Use `Polymer.PaperCheckedElementBehavior` to implement a custom element
   * that has a `checked` property similar to `Polymer.IronCheckedElementBehavior`
   * and is compatible with having a ripple effect.
   * @polymerBehavior Polymer.PaperCheckedElementBehavior
   */
  Polymer.PaperCheckedElementBehaviorImpl = {
    /**
     * Synchronizes the element's checked state with its ripple effect.
     */
    _checkedChanged: function() {
      Polymer.IronCheckedElementBehaviorImpl._checkedChanged.call(this);
      if (this.hasRipple()) {
        if (this.checked) {
          this._ripple.setAttribute('checked', '');
        } else {
          this._ripple.removeAttribute('checked');
        }
      }
    },

    /**
     * Synchronizes the element's `active` and `checked` state.
     */
    _buttonStateChanged: function() {
      Polymer.PaperRippleBehavior._buttonStateChanged.call(this);
      if (this.disabled) {
        return;
      }
      if (this.isAttached) {
        this.checked = this.active;
      }
    }
  };

  /** @polymerBehavior Polymer.PaperCheckedElementBehavior */
  Polymer.PaperCheckedElementBehavior = [
    Polymer.PaperInkyFocusBehavior,
    Polymer.IronCheckedElementBehavior,
    Polymer.PaperCheckedElementBehaviorImpl
  ];
</script>
<!--
Material design: [Checkbox](https://www.google.com/design/spec/components/selection-controls.html#selection-controls-checkbox)

`paper-checkbox` is a button that can be either checked or unchecked.  User
can tap the checkbox to check or uncheck it.  Usually you use checkboxes
to allow user to select multiple options from a set.  If you have a single
ON/OFF option, avoid using a single checkbox and use `paper-toggle-button`
instead.

Example:

    <paper-checkbox>label</paper-checkbox>

    <paper-checkbox checked> label</paper-checkbox>

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--paper-checkbox-unchecked-background-color` | Checkbox background color when the input is not checked | `transparent`
`--paper-checkbox-unchecked-color` | Checkbox border color when the input is not checked | `--primary-text-color`
`--paper-checkbox-unchecked-ink-color` | Selected/focus ripple color when the input is not checked | `--primary-text-color`
`--paper-checkbox-checked-color` | Checkbox color when the input is checked | `--primary-color`
`--paper-checkbox-checked-ink-color` | Selected/focus ripple color when the input is checked | `--primary-color`
`--paper-checkbox-checkmark-color` | Checkmark color | `white`
`--paper-checkbox-label-color` | Label color | `--primary-text-color`
`--paper-checkbox-label-checked-color` | Label color when the input is checked | `--paper-checkbox-label-color`
`--paper-checkbox-label-spacing` | Spacing between the label and the checkbox | `8px`
`--paper-checkbox-label` | Mixin applied to the label | `{}`
`--paper-checkbox-label-checked` | Mixin applied to the label when the input is checked | `{}`
`--paper-checkbox-error-color` | Checkbox color when invalid | `--error-color`
`--paper-checkbox-size` | Size of the checkbox | `18px`
`--paper-checkbox-ink-size` | Size of the ripple | `48px`
`--paper-checkbox-margin` | Margin around the checkbox container | `initial`
`--paper-checkbox-vertical-align` | Vertical alignment of the checkbox container | `middle`

This element applies the mixin `--paper-font-common-base` but does not import `paper-styles/typography.html`.
In order to apply the `Roboto` font to this element, make sure you've imported `paper-styles/typography.html`.

@demo demo/index.html
-->

<dom-module id="paper-checkbox" assetpath="../bower_components/paper-checkbox/">
  <template strip-whitespace="">
    <style>
      :host {
        display: inline-block;
        white-space: nowrap;
        cursor: pointer;
        --calculated-paper-checkbox-size: var(--paper-checkbox-size, 18px);
        /* -1px is a sentinel for the default and is replaced in `attached`. */
        --calculated-paper-checkbox-ink-size: var(--paper-checkbox-ink-size, -1px);
        @apply --paper-font-common-base;
        line-height: 0;
        -webkit-tap-highlight-color: transparent;
      }

      :host([hidden]) {
        display: none !important;
      }

      :host(:focus) {
        outline: none;
      }

      .hidden {
        display: none;
      }

      #checkboxContainer {
        display: inline-block;
        position: relative;
        width: var(--calculated-paper-checkbox-size);
        height: var(--calculated-paper-checkbox-size);
        min-width: var(--calculated-paper-checkbox-size);
        margin: var(--paper-checkbox-margin, initial);
        vertical-align: var(--paper-checkbox-vertical-align, middle);
        background-color: var(--paper-checkbox-unchecked-background-color, transparent);
      }

      #ink {
        position: absolute;

        /* Center the ripple in the checkbox by negative offsetting it by
         * (inkWidth - rippleWidth) / 2 */
        top: calc(0px - (var(--calculated-paper-checkbox-ink-size) - var(--calculated-paper-checkbox-size)) / 2);
        left: calc(0px - (var(--calculated-paper-checkbox-ink-size) - var(--calculated-paper-checkbox-size)) / 2);
        width: var(--calculated-paper-checkbox-ink-size);
        height: var(--calculated-paper-checkbox-ink-size);
        color: var(--paper-checkbox-unchecked-ink-color, var(--primary-text-color));
        opacity: 0.6;
        pointer-events: none;
      }

      :host-context([dir="rtl"]) #ink {
        right: calc(0px - (var(--calculated-paper-checkbox-ink-size) - var(--calculated-paper-checkbox-size)) / 2);
        left: auto;
      }

      #ink[checked] {
        color: var(--paper-checkbox-checked-ink-color, var(--primary-color));
      }

      #checkbox {
        position: relative;
        box-sizing: border-box;
        height: 100%;
        border: solid 2px;
        border-color: var(--paper-checkbox-unchecked-color, var(--primary-text-color));
        border-radius: 2px;
        pointer-events: none;
        -webkit-transition: background-color 140ms, border-color 140ms;
        transition: background-color 140ms, border-color 140ms;
      }

      /* checkbox checked animations */
      #checkbox.checked #checkmark {
        -webkit-animation: checkmark-expand 140ms ease-out forwards;
        animation: checkmark-expand 140ms ease-out forwards;
      }

      @-webkit-keyframes checkmark-expand {
        0% {
          -webkit-transform: scale(0, 0) rotate(45deg);
        }
        100% {
          -webkit-transform: scale(1, 1) rotate(45deg);
        }
      }

      @keyframes checkmark-expand {
        0% {
          transform: scale(0, 0) rotate(45deg);
        }
        100% {
          transform: scale(1, 1) rotate(45deg);
        }
      }

      #checkbox.checked {
        background-color: var(--paper-checkbox-checked-color, var(--primary-color));
        border-color: var(--paper-checkbox-checked-color, var(--primary-color));
      }

      #checkmark {
        position: absolute;
        width: 36%;
        height: 70%;
        border-style: solid;
        border-top: none;
        border-left: none;
        border-right-width: calc(2/15 * var(--calculated-paper-checkbox-size));
        border-bottom-width: calc(2/15 * var(--calculated-paper-checkbox-size));
        border-color: var(--paper-checkbox-checkmark-color, white);
        -webkit-transform-origin: 97% 86%;
        transform-origin: 97% 86%;
        box-sizing: content-box; /* protect against page-level box-sizing */
      }

      :host-context([dir="rtl"]) #checkmark {
        -webkit-transform-origin: 50% 14%;
        transform-origin: 50% 14%;
      }

      /* label */
      #checkboxLabel {
        position: relative;
        display: inline-block;
        vertical-align: middle;
        padding-left: var(--paper-checkbox-label-spacing, 8px);
        white-space: normal;
        line-height: normal;
        color: var(--paper-checkbox-label-color, var(--primary-text-color));
        @apply --paper-checkbox-label;
      }

      :host([checked]) #checkboxLabel {
        color: var(--paper-checkbox-label-checked-color, var(--paper-checkbox-label-color, var(--primary-text-color)));
        @apply --paper-checkbox-label-checked;
      }

      :host-context([dir="rtl"]) #checkboxLabel {
        padding-right: var(--paper-checkbox-label-spacing, 8px);
        padding-left: 0;
      }

      #checkboxLabel[hidden] {
        display: none;
      }

      /* disabled state */

      :host([disabled]) #checkbox {
        opacity: 0.5;
        border-color: var(--paper-checkbox-unchecked-color, var(--primary-text-color));
      }

      :host([disabled][checked]) #checkbox {
        background-color: var(--paper-checkbox-unchecked-color, var(--primary-text-color));
        opacity: 0.5;
      }

      :host([disabled]) #checkboxLabel  {
        opacity: 0.65;
      }

      /* invalid state */
      #checkbox.invalid:not(.checked) {
        border-color: var(--paper-checkbox-error-color, var(--error-color));
      }
    </style>

    <div id="checkboxContainer">
      <div id="checkbox" class$="[[_computeCheckboxClass(checked, invalid)]]">
        <div id="checkmark" class$="[[_computeCheckmarkClass(checked)]]"></div>
      </div>
    </div>

    <div id="checkboxLabel"><slot></slot></div>
  </template>

  <script>
    Polymer({
      is: 'paper-checkbox',

      behaviors: [
        Polymer.PaperCheckedElementBehavior
      ],

      hostAttributes: {
        role: 'checkbox',
        'aria-checked': false,
        tabindex: 0
      },

      properties: {
        /**
         * Fired when the checked state changes due to user interaction.
         *
         * @event change
         */

        /**
         * Fired when the checked state changes.
         *
         * @event iron-change
         */
        ariaActiveAttribute: {
          type: String,
          value: 'aria-checked'
        }
      },

      attached: function() {
        // Wait until styles have resolved to check for the default sentinel.
        // See polymer#4009 for more details.
        Polymer.RenderStatus.afterNextRender(this, function() {
          var inkSize = this.getComputedStyleValue('--calculated-paper-checkbox-ink-size').trim();
          // If unset, compute and set the default `--paper-checkbox-ink-size`.
          if (inkSize === '-1px') {
            var checkboxSize = parseFloat(this.getComputedStyleValue('--calculated-paper-checkbox-size').trim());
            var defaultInkSize = Math.floor((8 / 3) * checkboxSize);

            // The checkbox and ripple need to have the same parity so that their
            // centers align.
            if (defaultInkSize % 2 !== checkboxSize % 2) {
              defaultInkSize++;
            }

            this.updateStyles({
              '--paper-checkbox-ink-size': defaultInkSize + 'px',
            });
          }
        });
      },

      _computeCheckboxClass: function(checked, invalid) {
        var className = '';
        if (checked) {
          className += 'checked ';
        }
        if (invalid) {
          className += 'invalid';
        }
        return className;
      },

      _computeCheckmarkClass: function(checked) {
        return checked ? '' : 'hidden';
      },

      // create ripple inside the checkboxContainer
      _createRipple: function() {
        this._rippleContainer = this.$.checkboxContainer;
        return Polymer.PaperInkyFocusBehaviorImpl._createRipple.call(this);
      }

    });
  </script>
</dom-module>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
--><!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
--><script>
(function() {
'use strict';

/**
Use `Polymer.PaperDialogBehavior` and `paper-dialog-shared-styles.html` to implement a Material Design
dialog.

For example, if `<paper-dialog-impl>` implements this behavior:

    <paper-dialog-impl>
        <h2>Header</h2>
        <div>Dialog body</div>
        <div class="buttons">
            <paper-button dialog-dismiss>Cancel</paper-button>
            <paper-button dialog-confirm>Accept</paper-button>
        </div>
    </paper-dialog-impl>

`paper-dialog-shared-styles.html` provide styles for a header, content area, and an action area for buttons.
Use the `<h2>` tag for the header and the `buttons` class for the action area. You can use the
`paper-dialog-scrollable` element (in its own repository) if you need a scrolling content area.

Use the `dialog-dismiss` and `dialog-confirm` attributes on interactive controls to close the
dialog. If the user dismisses the dialog with `dialog-confirm`, the `closingReason` will update
to include `confirmed: true`.

### Accessibility

This element has `role="dialog"` by default. Depending on the context, it may be more appropriate
to override this attribute with `role="alertdialog"`.

If `modal` is set, the element will prevent the focus from exiting the element.
It will also ensure that focus remains in the dialog.

@hero hero.svg
@demo demo/index.html
@polymerBehavior Polymer.PaperDialogBehavior
*/

  Polymer.PaperDialogBehaviorImpl = {

    hostAttributes: {
      'role': 'dialog',
      'tabindex': '-1'
    },

    properties: {

      /**
       * If `modal` is true, this implies `no-cancel-on-outside-click`, `no-cancel-on-esc-key` and `with-backdrop`.
       */
      modal: {
        type: Boolean,
        value: false
      },

      __readied: {
        type: Boolean,
        value: false
      }

    },

    observers: [
      '_modalChanged(modal, __readied)'
    ],

    listeners: {
      'tap': '_onDialogClick'
    },

    ready: function() {
      // Only now these properties can be read.
      this.__prevNoCancelOnOutsideClick = this.noCancelOnOutsideClick;
      this.__prevNoCancelOnEscKey = this.noCancelOnEscKey;
      this.__prevWithBackdrop = this.withBackdrop;
      this.__readied = true;
    },

    _modalChanged: function(modal, readied) {
      // modal implies noCancelOnOutsideClick, noCancelOnEscKey and withBackdrop.
      // We need to wait for the element to be ready before we can read the
      // properties values.
      if (!readied) {
        return;
      }

      if (modal) {
        this.__prevNoCancelOnOutsideClick = this.noCancelOnOutsideClick;
        this.__prevNoCancelOnEscKey = this.noCancelOnEscKey;
        this.__prevWithBackdrop = this.withBackdrop;
        this.noCancelOnOutsideClick = true;
        this.noCancelOnEscKey = true;
        this.withBackdrop = true;
      } else {
        // If the value was changed to false, let it false.
        this.noCancelOnOutsideClick = this.noCancelOnOutsideClick &&
          this.__prevNoCancelOnOutsideClick;
        this.noCancelOnEscKey = this.noCancelOnEscKey &&
          this.__prevNoCancelOnEscKey;
        this.withBackdrop = this.withBackdrop && this.__prevWithBackdrop;
      }
    },

    _updateClosingReasonConfirmed: function(confirmed) {
      this.closingReason = this.closingReason || {};
      this.closingReason.confirmed = confirmed;
    },

    /**
     * Will dismiss the dialog if user clicked on an element with dialog-dismiss
     * or dialog-confirm attribute.
     */
    _onDialogClick: function(event) {
      // Search for the element with dialog-confirm or dialog-dismiss,
      // from the root target until this (excluded).
      var path = Polymer.dom(event).path;
      for (var i = 0, l = path.indexOf(this); i < l; i++) {
        var target = path[i];
        if (target.hasAttribute && (target.hasAttribute('dialog-dismiss') || target.hasAttribute('dialog-confirm'))) {
          this._updateClosingReasonConfirmed(target.hasAttribute('dialog-confirm'));
          this.close();
          event.stopPropagation();
          break;
        }
      }
    }

  };

  /** @polymerBehavior */
  Polymer.PaperDialogBehavior = [Polymer.IronOverlayBehavior, Polymer.PaperDialogBehaviorImpl];

})();
</script>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
--><!--
### Styling

The following custom properties and mixins are available for styling.

Custom property | Description | Default
----------------|-------------|----------
`--paper-dialog-background-color` | Dialog background color                     | `--primary-background-color`
`--paper-dialog-color`            | Dialog foreground color                     | `--primary-text-color`
`--paper-dialog`                  | Mixin applied to the dialog                 | `{}`
`--paper-dialog-title`            | Mixin applied to the title (`<h2>`) element | `{}`
`--paper-dialog-button-color`     | Button area foreground color                | `--default-primary-color`
-->

<dom-module id="paper-dialog-shared-styles" assetpath="../bower_components/paper-dialog-behavior/">
  <template>
    <style>
      :host {
        display: block;
        margin: 24px 40px;

        background: var(--paper-dialog-background-color, var(--primary-background-color));
        color: var(--paper-dialog-color, var(--primary-text-color));

        @apply --paper-font-body1;
        @apply --shadow-elevation-16dp;
        @apply --paper-dialog;
      }

      :host > ::slotted(*) {
        margin-top: 20px;
        padding: 0 24px;
      }

      :host > ::slotted(.no-padding) {
        padding: 0;
      }

      /* In 1.x, this selector was `:host > ::content h2`. In 2.x <slot> allows
      to only select only direct children, which increases the weight of this
      selector, so we have to move it before first-child/last-child selectors */
      :host > ::slotted(h2) {
        position: relative;
        margin: 0;
        @apply --paper-font-title;

        @apply --paper-dialog-title;
      }

      :host > ::slotted(*:first-child) {
        margin-top: 24px;
      }

      :host > ::slotted(*:last-child) {
        margin-bottom: 24px;
      }

      :host > ::slotted(.buttons) {
        position: relative;
        padding: 8px 8px 8px 24px;
        margin: 0;

        color: var(--paper-dialog-button-color, var(--primary-color));

        @apply --layout-horizontal;
        @apply --layout-end-justified;
      }
    </style>
  </template>
</dom-module>
<!--
Material design: [Dialogs](https://www.google.com/design/spec/components/dialogs.html)

`<paper-dialog>` is a dialog with Material Design styling and optional animations when it is
opened or closed. It provides styles for a header, content area, and an action area for buttons.
You can use the `<paper-dialog-scrollable>` element (in its own repository) if you need a scrolling
content area. To autofocus a specific child element after opening the dialog, give it the `autofocus`
attribute. See `Polymer.PaperDialogBehavior` and `Polymer.IronOverlayBehavior` for specifics.

For example, the following code implements a dialog with a header, scrolling content area and
buttons. Focus will be given to the `dialog-confirm` button when the dialog is opened.

    <paper-dialog>
      <h2>Header</h2>
      <paper-dialog-scrollable>
        Lorem ipsum...
      </paper-dialog-scrollable>
      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm autofocus>Accept</paper-button>
      </div>
    </paper-dialog>

### Styling

See the docs for `Polymer.PaperDialogBehavior` for the custom properties available for styling
this element.

### Animations

Set the `entry-animation` and/or `exit-animation` attributes to add an animation when the dialog
is opened or closed. See the documentation in
[PolymerElements/neon-animation](https://github.com/PolymerElements/neon-animation) for more info.

For example:

    <link rel="import" href="components/neon-animation/animations/scale-up-animation.html">
    <link rel="import" href="components/neon-animation/animations/fade-out-animation.html">

    <paper-dialog entry-animation="scale-up-animation"
                  exit-animation="fade-out-animation">
      <h2>Header</h2>
      <div>Dialog body</div>
    </paper-dialog>

### Accessibility

See the docs for `Polymer.PaperDialogBehavior` for accessibility features implemented by this
element.

@group Paper Elements
@element paper-dialog
@hero hero.svg
@demo demo/index.html
-->

<dom-module id="paper-dialog" assetpath="../bower_components/paper-dialog/">
  <template>
    <style include="paper-dialog-shared-styles"></style>
    <slot></slot>
  </template>
</dom-module>

<script>

(function() {
'use strict';

  Polymer({

    is: 'paper-dialog',

    behaviors: [
      Polymer.PaperDialogBehavior,
      Polymer.NeonAnimationRunnerBehavior
    ],

    listeners: {
      'neon-animation-finish': '_onNeonAnimationFinish'
    },

    _renderOpened: function() {
      this.cancelAnimation();
      this.playAnimation('entry');
    },

    _renderClosed: function() {
      this.cancelAnimation();
      this.playAnimation('exit');
    },

    _onNeonAnimationFinish: function() {
      if (this.opened) {
        this._finishRenderOpened();
      } else {
        this._finishRenderClosed();
      }
    }

  });

})();

</script>
<!--
@license
Copyright (c) 2016 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
--><!--
`<vaadin-upload>` is a Polymer element for uploading multiple files with drag and drop support.

Example:

```html
<vaadin-upload></vaadin-upload>
```

### Styling

The following custom properties are available for styling the component.

Custom property | Description | Default
----------------|-------------|----------
`--vaadin-upload-drag-ripple`|A mixin that is applied to the ripple animation in the drop area|`{}`
`--vaadin-upload-drop-label`|A mixin that is applied to the drop label|`{}`
`--vaadin-upload-drop-label-dragover`|A mixin that is applied to the drop label when overing the component with files|`{}`
`--vaadin-upload-drop-label-icon`|A mixin that is applied to the drop icon|`{}`
`--vaadin-upload-file-list`|A mixin that is applied to the file list|`{}`
`--vaadin-upload-buttons`|A mixin that is applied to the buttons container|`{}`
`--vaadin-upload-buttons-primary`|A mixin that is applied to the primary buttons container (left side)|`{}`
`--vaadin-upload-buttons-secondary`|A mixin that is applied to the secondary buttons container (right side)|`{}`
`--vaadin-upload-button-add-wrapper`|A mixin that is applied to the div wrapping the upload button|`{}`
`--vaadin-upload-button-add`|A mixin that is applied to the upload button|`{}`
`--vaadin-upload-button-add-disabled`|A mixin that is applied to the upload button when `maxFiles` limit is reached|`{}`



@element vaadin-upload
@demo demo/index.html
--><!--
@license
Copyright (c) 2016 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
--><!--
These icons were copied from http://github.com/PolymerElements/iron-icons

Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
--><!--
`vaadin-upload-icons` is an iconset containing icons used by `<vaadin-upload>` or `<vaadin-upload-file>`
--><iron-iconset-svg name="vaadin-upload" size="24">
<svg><defs>
<g id="clear"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></g>
<g id="done"><path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"></path></g>
<g id="file-upload"><path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"></path></g>
<g id="refresh"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"></path></g>
<g id="warning"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"></path></g>
</defs></svg>
</iron-iconset-svg>
<!--
@license
Copyright (c) 2016 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
--><!--
`<vaadin-upload-file>` element represents a file in the file list of `<vaadin-upload>`.

### Styling

The following custom properties are available for styling the component.

Custom property | Description | Default
----------------|-------------|----------
`--vaadin-upload-file`|A mixin that is applied to the host element|`{}`
`--vaadin-upload-file-row`|A mixin that is applied to the file row|`{}`
`--vaadin-upload-file-status-icon`|A mixin that is applied to all file status icons. By default, file status icons are hidden until the upload process finishes.|`{}`
`--vaadin-upload-file-status-icon-complete`|A mixin that is applied to the complete status icon when the upload process succeeds|`{}`
`--vaadin-upload-file-status-icon-error`|A mixin that is applied to the error status icon when the upload process fails|`{}`
`--vaadin-upload-file-meta`|A mixin that is applied to the info container|`{}`
`--vaadin-upload-file-meta-complete`|A mixin that is applied to the info container when file upload is complete|`{}`
`--vaadin-upload-file-meta-error`|A mixin that is applied to the info container when an error happens|`{}`
`--vaadin-upload-file-name`|A mixin that is applied to the file name|`{}`
`--vaadin-upload-file-status`|A mixin that is applied to the file status label|`{}`
`--vaadin-upload-file-error`|A mixin that is applied to the file error label|`{}`
`--vaadin-upload-file-commands`|A mixin that is applied to the buttons container|`{}`
`--vaadin-upload-file-progress`|A mixin that is applied to the included paper-progress|`{}`
`--vaadin-upload-file-progress-error`|A mixin that is applied to the progress bar when error is set|`{}`
`--vaadin-upload-file-progress-indeterminate`|A mixin that is applied to the progress bar when indeterminate|`{}`
`--vaadin-upload-file-progress-uploading-indeterminate`|A mixin that is applied to the progress bar when uploading and indeterminate|`{}`
`--vaadin-upload-file-progress-complete`|A mixin that is applied to the progress when file is complete|`{}`
`--vaadin-upload-file-canceled`|A mixin that is applied to the upload cancel animation|`{}`

@element vaadin-upload-file
@demo demo/
--><!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
--><!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
--><script>

 /**
 * `iron-range-behavior` provides the behavior for something with a minimum to maximum range.
 *
 * @demo demo/index.html
 * @polymerBehavior
 */
 Polymer.IronRangeBehavior = {

  properties: {

    /**
     * The number that represents the current value.
     */
    value: {
      type: Number,
      value: 0,
      notify: true,
      reflectToAttribute: true
    },

    /**
     * The number that indicates the minimum value of the range.
     */
    min: {
      type: Number,
      value: 0,
      notify: true
    },

    /**
     * The number that indicates the maximum value of the range.
     */
    max: {
      type: Number,
      value: 100,
      notify: true
    },

    /**
     * Specifies the value granularity of the range's value.
     */
    step: {
      type: Number,
      value: 1,
      notify: true
    },

    /**
     * Returns the ratio of the value.
     */
    ratio: {
      type: Number,
      value: 0,
      readOnly: true,
      notify: true
    },
  },

  observers: [
    '_update(value, min, max, step)'
  ],

  _calcRatio: function(value) {
    return (this._clampValue(value) - this.min) / (this.max - this.min);
  },

  _clampValue: function(value) {
    return Math.min(this.max, Math.max(this.min, this._calcStep(value)));
  },

  _calcStep: function(value) {
    // polymer/issues/2493
    value = parseFloat(value);

    if (!this.step) {
      return value;
    }

    var numSteps = Math.round((value - this.min) / this.step);
    if (this.step < 1) {
     /**
      * For small values of this.step, if we calculate the step using
      * `Math.round(value / step) * step` we may hit a precision point issue
      * eg. 0.1 * 0.2 =  0.020000000000000004
      * http://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html
      *
      * as a work around we can divide by the reciprocal of `step`
      */
      return numSteps / (1 / this.step) + this.min;
    } else {
      return numSteps * this.step + this.min;
    }
  },

  _validateValue: function() {
    var v = this._clampValue(this.value);
    this.value = this.oldValue = isNaN(v) ? this.oldValue : v;
    return this.value !== v;
  },

  _update: function() {
    this._validateValue();
    this._setRatio(this._calcRatio(this.value) * 100);
  }

};
</script>
<!--
Material design: [Progress & activity](https://www.google.com/design/spec/components/progress-activity.html)

The progress bars are for situations where the percentage completed can be
determined. They give users a quick sense of how much longer an operation
will take.

Example:

    <paper-progress value="10"></paper-progress>

There is also a secondary progress which is useful for displaying intermediate
progress, such as the buffer level during a streaming playback progress bar.

Example:

    <paper-progress value="10" secondary-progress="30"></paper-progress>

### Styling progress bar:

To change the active progress bar color:

    paper-progress {
       --paper-progress-active-color: #e91e63;
    }

To change the secondary progress bar color:

    paper-progress {
      --paper-progress-secondary-color: #f8bbd0;
    }

To change the progress bar background color:

    paper-progress {
      --paper-progress-container-color: #64ffda;
    }

Add the class `transiting` to a paper-progress to animate the progress bar when
the value changed. You can also customize the transition:

    paper-progress {
      --paper-progress-transition-duration: 0.08s;
      --paper-progress-transition-timing-function: ease;
      --paper-progress-transition-transition-delay: 0s;
    }

To change the duration of the indeterminate cycle:

    paper-progress {
      --paper-progress-indeterminate-cycle-duration: 2s;
    }

The following mixins are available for styling:

Custom property                                  | Description                                 | Default
-------------------------------------------------|---------------------------------------------|--------------
`--paper-progress-container`                     | Mixin applied to container                  | `{}`
`--paper-progress-transition-duration`           | Duration of the transition                  | `0.008s`
`--paper-progress-transition-timing-function`    | The timing function for the transition      | `ease`
`--paper-progress-transition-delay`              | delay for the transition                    | `0s`
`--paper-progress-container-color`               | Color of the container                      | `--google-grey-300`
`--paper-progress-active-color`                  | The color of the active bar                 | `--google-green-500`
`--paper-progress-secondary-color`               | The color of the secondary bar              | `--google-green-100`
`--paper-progress-disabled-active-color`         | The color of the active bar if disabled     | `--google-grey-500`
`--paper-progress-disabled-secondary-color`      | The color of the secondary bar if disabled  | `--google-grey-300`
`--paper-progress-height`                        | The height of the progress bar              | `4px`
`--paper-progress-indeterminate-cycle-duration`  | Duration of an indeterminate cycle          | `2s`

@group Paper Elements
@element paper-progress
@hero hero.svg
@demo demo/index.html
-->

<dom-module id="paper-progress" assetpath="../bower_components/paper-progress/">
  <template>
    <style>
      :host {
        display: block;
        width: 200px;
        position: relative;
        overflow: hidden;
      }

      :host([hidden]), [hidden] {
        display: none !important;
      }

      #progressContainer {
        @apply --paper-progress-container;
        position: relative;
      }

      #progressContainer,
      /* the stripe for the indeterminate animation*/
      .indeterminate::after {
        height: var(--paper-progress-height, 4px);
      }

      #primaryProgress,
      #secondaryProgress,
      .indeterminate::after {
        @apply --layout-fit;
      }

      #progressContainer,
      .indeterminate::after {
        background: var(--paper-progress-container-color, var(--google-grey-300));
      }

      :host(.transiting) #primaryProgress,
      :host(.transiting) #secondaryProgress {
        -webkit-transition-property: -webkit-transform;
        transition-property: transform;

        /* Duration */
        -webkit-transition-duration: var(--paper-progress-transition-duration, 0.08s);
        transition-duration: var(--paper-progress-transition-duration, 0.08s);

        /* Timing function */
        -webkit-transition-timing-function: var(--paper-progress-transition-timing-function, ease);
        transition-timing-function: var(--paper-progress-transition-timing-function, ease);

        /* Delay */
        -webkit-transition-delay: var(--paper-progress-transition-delay, 0s);
        transition-delay: var(--paper-progress-transition-delay, 0s);
      }

      #primaryProgress,
      #secondaryProgress {
        @apply --layout-fit;
        -webkit-transform-origin: left center;
        transform-origin: left center;
        -webkit-transform: scaleX(0);
        transform: scaleX(0);
        will-change: transform;
      }

      #primaryProgress {
        background: var(--paper-progress-active-color, var(--google-green-500));
      }

      #secondaryProgress {
        background: var(--paper-progress-secondary-color, var(--google-green-100));
      }

      :host([disabled]) #primaryProgress {
        background: var(--paper-progress-disabled-active-color, var(--google-grey-500));
      }

      :host([disabled]) #secondaryProgress {
        background: var(--paper-progress-disabled-secondary-color, var(--google-grey-300));
      }

      :host(:not([disabled])) #primaryProgress.indeterminate {
        -webkit-transform-origin: right center;
        transform-origin: right center;
        -webkit-animation: indeterminate-bar var(--paper-progress-indeterminate-cycle-duration, 2s) linear infinite;
        animation: indeterminate-bar var(--paper-progress-indeterminate-cycle-duration, 2s) linear infinite;
      }

      :host(:not([disabled])) #primaryProgress.indeterminate::after {
        content: "";
        -webkit-transform-origin: center center;
        transform-origin: center center;

        -webkit-animation: indeterminate-splitter var(--paper-progress-indeterminate-cycle-duration, 2s) linear infinite;
        animation: indeterminate-splitter var(--paper-progress-indeterminate-cycle-duration, 2s) linear infinite;
      }

      @-webkit-keyframes indeterminate-bar {
        0% {
          -webkit-transform: scaleX(1) translateX(-100%);
        }
        50% {
          -webkit-transform: scaleX(1) translateX(0%);
        }
        75% {
          -webkit-transform: scaleX(1) translateX(0%);
          -webkit-animation-timing-function: cubic-bezier(.28,.62,.37,.91);
        }
        100% {
          -webkit-transform: scaleX(0) translateX(0%);
        }
      }

      @-webkit-keyframes indeterminate-splitter {
        0% {
          -webkit-transform: scaleX(.75) translateX(-125%);
        }
        30% {
          -webkit-transform: scaleX(.75) translateX(-125%);
          -webkit-animation-timing-function: cubic-bezier(.42,0,.6,.8);
        }
        90% {
          -webkit-transform: scaleX(.75) translateX(125%);
        }
        100% {
          -webkit-transform: scaleX(.75) translateX(125%);
        }
      }

      @keyframes indeterminate-bar {
        0% {
          transform: scaleX(1) translateX(-100%);
        }
        50% {
          transform: scaleX(1) translateX(0%);
        }
        75% {
          transform: scaleX(1) translateX(0%);
          animation-timing-function: cubic-bezier(.28,.62,.37,.91);
        }
        100% {
          transform: scaleX(0) translateX(0%);
        }
      }

      @keyframes indeterminate-splitter {
        0% {
          transform: scaleX(.75) translateX(-125%);
        }
        30% {
          transform: scaleX(.75) translateX(-125%);
          animation-timing-function: cubic-bezier(.42,0,.6,.8);
        }
        90% {
          transform: scaleX(.75) translateX(125%);
        }
        100% {
          transform: scaleX(.75) translateX(125%);
        }
      }
    </style>

    <div id="progressContainer">
      <div id="secondaryProgress" hidden$="[[_hideSecondaryProgress(secondaryRatio)]]"></div>
      <div id="primaryProgress"></div>
    </div>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'paper-progress',

    behaviors: [
      Polymer.IronRangeBehavior
    ],

    properties: {
      /**
       * The number that represents the current secondary progress.
       */
      secondaryProgress: {
        type: Number,
        value: 0
      },

      /**
       * The secondary ratio
       */
      secondaryRatio: {
        type: Number,
        value: 0,
        readOnly: true
      },

      /**
       * Use an indeterminate progress indicator.
       */
      indeterminate: {
        type: Boolean,
        value: false,
        observer: '_toggleIndeterminate'
      },

      /**
       * True if the progress is disabled.
       */
      disabled: {
        type: Boolean,
        value: false,
        reflectToAttribute: true,
        observer: '_disabledChanged'
      }
    },

    observers: [
      '_progressChanged(secondaryProgress, value, min, max, indeterminate)'
    ],

    hostAttributes: {
      role: 'progressbar'
    },

    _toggleIndeterminate: function(indeterminate) {
      // If we use attribute/class binding, the animation sometimes doesn't translate properly
      // on Safari 7.1. So instead, we toggle the class here in the update method.
      this.toggleClass('indeterminate', indeterminate, this.$.primaryProgress);
    },

    _transformProgress: function(progress, ratio) {
      var transform = 'scaleX(' + (ratio / 100) + ')';
      progress.style.transform = progress.style.webkitTransform = transform;
    },

    _mainRatioChanged: function(ratio) {
      this._transformProgress(this.$.primaryProgress, ratio);
    },

    _progressChanged: function(secondaryProgress, value, min, max, indeterminate) {
      secondaryProgress = this._clampValue(secondaryProgress);
      value = this._clampValue(value);

      var secondaryRatio = this._calcRatio(secondaryProgress) * 100;
      var mainRatio = this._calcRatio(value) * 100;

      this._setSecondaryRatio(secondaryRatio);
      this._transformProgress(this.$.secondaryProgress, secondaryRatio);
      this._transformProgress(this.$.primaryProgress, mainRatio);

      this.secondaryProgress = secondaryProgress;

      if (indeterminate) {
        this.removeAttribute('aria-valuenow');
      } else {
        this.setAttribute('aria-valuenow', value);
      }
      this.setAttribute('aria-valuemin', min);
      this.setAttribute('aria-valuemax', max);
    },

    _disabledChanged: function(disabled) {
      this.setAttribute('aria-disabled', disabled ? 'true' : 'false');
    },

    _hideSecondaryProgress: function(secondaryRatio) {
      return secondaryRatio === 0;
    }
  });
</script>
<dom-module id="vaadin-upload-file" assetpath="../bower_components/vaadin-upload/">
  <template>
    <style>
      :host {
        @apply --layout-vertical;
        margin: 4px 0 0;
        padding: 6px 0 4px;
        @apply --vaadin-upload-file;
      }

      #row {
        @apply --layout-horizontal;
        @apply --layout-center;
        height: 36px;
        @apply --vaadin-upload-file-row;
      }

      iron-icon {
        width: 24px;
        height: 24px;
        padding: 8px;
        color: var(--primary-text-color, #000);
        opacity: 0;
        margin-right: -40px;
        transition: margin-right 0.3s 0.1s, opacity 0.3s;
        @apply --vaadin-upload-file-status-icon;
      }

      iron-icon[icon="vaadin-upload:warning"] {
        color: var(--error-color, #f40303);
      }

      iron-icon[complete],
      iron-icon[error] {
        margin-right: 0;
        opacity: 1;
        transition: margin-right 0.3s, opacity 0.3s 0.1s;
      }

      iron-icon[complete] {
        @apply --vaadin-upload-file-status-icon-complete;
      }

      iron-icon[error] {
        @apply --vaadin-upload-file-status-icon-error;
      }

      #meta {
        @apply --layout-vertical;
        @apply --layout-flex;
        height: 32px;
        transition: height 0.1s;
        width: 1px;
        color: var(--disabled-text-color, gray);
        overflow: hidden;
        @apply --vaadin-upload-file-meta;
      }

      #meta[complete] {
        height: 16px;
        color: var(--primary-text-color, #000);
        @apply --vaadin-upload-file-meta-complete;
      }

      #meta[error] {
        color: var(--error-color, #f40303);
        @apply --vaadin-upload-file-meta-error;
      }

      #name,
      #status,
      #error {
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        line-height: 16px !important;
      }

      #name {
        @apply --paper-font-body2;
        @apply --vaadin-upload-file-name;
      }

      #status {
        @apply --paper-font-caption;
        color: var(--disabled-text-color, gray);
        @apply --vaadin-upload-file-status;
      }

      #error {
        @apply --paper-font-caption;
        color: var(--error-color, #f40303);
        @apply --vaadin-upload-file-error;
      }

      #commands {
        @apply --layout-horizontal;
        @apply --vaadin-upload-file-commands;
      }

      #commands [icon] {
        color: var(--primary-text-color, #000);
      }

      #commands [icon="vaadin-upload:refresh"],
      #commands [icon="vaadin-upload:clear"] {
        color: var(--primary-color, #00B4F0);
      }

      paper-progress {
        --paper-progress-active-color: var(--primary-color, #00B4F0);
        width: 100%;
        height: 2px;
        @apply --vaadin-upload-file-progress;
      }

      paper-progress[error] {
        --paper-progress-container-color: var(--error-color, #f40303);
        --paper-progress-active-color: var(--error-color, #f40303);
        @apply --vaadin-upload-file-progress-error;
      }

      paper-progress[indeterminate] {
        --paper-progress-container-color: var(--primary-color, #00B4F0);
        --paper-progress-active-color: rgba(1, 97, 155, 0.5);
        @apply --vaadin-upload-file-progress-indeterminate;
      }

      paper-progress[uploading][indeterminate] {
        --paper-progress-container-color: var(--divider-color, #e0e0e0);
        --paper-progress-active-color: var(--disabled-text-color, gray);
        @apply --vaadin-upload-file-progress-uploading-indeterminate;
      }

      paper-progress[complete] {
        @apply --vaadin-upload-file-progress-complete;
      }

      paper-icon-button[hidden] {
        display: none;
      }

      :host(.fade-out) {
        animation-name: fade-out;
        animation-duration: 0.6s;
        @apply --vaadin-upload-file-canceled;
      }

      @keyframes fade-out {
        0% {
          max-height: 38px;
        }

        33% {
          max-height: 38px;
          margin: 4px 0 0;
          padding: 6px 0 4px;
          opacity: 0.25;
        }

        67% {
          opacity: 0;
        }

        100% {
          max-height: 0;
          margin: 0;
          padding: 0;
          opacity: 0;
        }
      }
    </style>

    <div id="row">

      <iron-icon icon="vaadin-upload:done" complete$="[[file.complete]]"></iron-icon>
      <iron-icon icon="vaadin-upload:warning" error$="[[file.error]]"></iron-icon>

      <div id="meta" complete$="[[file.complete]]" error$="[[file.error]]">
        <div id="name">[[file.name]]</div>
        <div id="status" hidden$="[[!file.status]]">[[file.status]]</div>
        <div id="error" hidden$="[[!file.error]]">[[file.error]]</div>
      </div>

      <div id="commands">
        <paper-icon-button icon="vaadin-upload:refresh" file-event="file-retry" on-tap="_fireFileEvent" hidden$="[[!file.error]]"></paper-icon-button>
        <paper-icon-button icon="vaadin-upload:clear" file-event="file-abort" on-tap="_fireFileEvent"></paper-icon-button>
      </div>

    </div>

    <paper-progress id="progress" value$="[[file.progress]]" error$="[[file.error]]" indeterminate$="[[file.indeterminate]]" uploading$="[[file.uploading]]" complete$="[[file.complete]]">
    </paper-progress>

  </template>
</dom-module>

<script>

  Polymer({

    is: 'vaadin-upload-file',

    properties: {
      /**
       * File metadata, upload status and progress information.
       */
      file: Object
    },

    observers: [
      '_fileChanged(file.*)',
      '_fileAborted(file.abort)'
    ],

    _fileChanged: function() {
      this.$.progress.updateStyles();
    },

    ready: function() {
      this.addEventListener('animationend', function(e) {
        // Animation name is scoped to "fade-out-vaadin-upload-file-0" on
        // Polymer 1 & Shady combination, so check with indexOf
        if (e.animationName.indexOf('fade-out') > -1) {
          this._remove();
        }
      });
    },

    _fileAborted: function(abort) {
      if (abort) {
        this.toggleClass('fade-out', true);

        // In case the animation doesn't trigger, just remove the file instantly.
        var animationName = window.getComputedStyle(this).animationName;
        if (!animationName || animationName === 'none') {
          this._remove();
        }
      }
    },

    _remove: function() {
      this.toggleClass('fade-out', false);
      this.fire('file-remove', {file: this.file});
    },

    _fireFileEvent: function(e) {
      e.preventDefault();
      var button = Polymer.dom(e).localTarget;
      return this.fire(button.getAttribute('file-event'), {file: this.file});
    }

   /**
    * Fired when the retry button is pressed. It is listened by `vaadin-upload`
    * which will start a new upload process of this file.
    *
    * @event file-retry
    * @param {Object} detail
    *  @param {Object} detail.file file to retry upload of
    */

    /**
     * Fired when abort button is pressed. It is listened by `vaadin-upload` which
     * will abort the upload in progress, but will not remove the file from the list
     * to allow the animation to hide the element to be run.
     *
     * @event file-abort
     * @param {Object} detail
     *  @param {Object} detail.file file to abort upload of
     */

    /**
     * Fired after the animation to hide the element has finished. It is listened
     * by `vaadin-upload` which will actually remove the file from the upload
     * file list.
     *
     * @event file-remove
     * @param {Object} detail
     *  @param {Object} detail.file file to remove from the  upload of
     */
  });

</script>
<dom-module id="vaadin-upload" assetpath="../bower_components/vaadin-upload/">
  <template>
    <style>
      :host {
        @apply --layout-vertical;
        display: block;
        position: relative;
        text-align: left;
      }

      :host(:not([nodrop])) {
        border: 1px dashed;
        border-color: var(--divider-color, #666);
        border-radius: 3px;
        overflow: hidden;
        padding: 16px;
      }

      :host([dragover-valid]) {
        border-color: var(--primary-color, #00B4F0);
      }

      /*
        Cover the entire element with transparent overlay when dragging files
        over it. Helps to reduce the amount of events fired.
      */
      :host::before {
        @apply --layout-fit;
        content: '';
        display: none;
        z-index: 10;
      }

      :host([dragover])::before {
        display: block;
      }

      #dragRipple {
        color: var(--light-primary-color, #7CD8F7);
        @apply --vaadin-upload-drag-ripple;
      }

      #dropLabel {
        @apply --layout-flex;
        @apply --paper-font-body2;
        position: relative;
        padding: .43em .57em;
        margin: 0 .29em;
        color: var(--disabled-text-color, #b3b3b3);
        @apply --vaadin-upload-drop-label;
      }

      :host([dragover-valid]) #dropLabel {
        color: var(--primary-color, #00B4F0);
        @apply --vaadin-upload-drop-label-dragover;
      }

      #dropLabel ::slotted(iron-icon),
      #dropLabelIcon {
        margin-right: .25em;
        @apply --vaadin-upload-drop-label-icon;
      }

      #fileList {
        position: relative;
        @apply --vaadin-upload-file-list;
      }

      #buttons {
        @apply --layout-horizontal;
        position: relative;
        @apply --vaadin-upload-buttons;
      }

      #buttonsPrimary {
        @apply --layout-horizontal;
        @apply --layout-flex;
        @apply --layout-start;
        margin-left: -.29em;
        @apply --vaadin-upload-buttons-primary;
      }

      #addFiles {
        @apply --vaadin-upload-button-add-wrapper;
      }

      #addButton {
        @apply --paper-font-button;
        padding: .43em .57em;
        background: var(--primary-color, #00B4F0);
        color: var(--primary-font-color, #FFF);
        @apply --vaadin-upload-button-add;
      }

      #addButton[disabled] {
        background: var(--divider-color, #e0e0e0);
        color: var(--disabled-text-color, gray);
        @apply --vaadin-upload-button-add-disabled;
      }
    </style>

    <div id="buttons">
      <div id="buttonsPrimary">
        <div id="addFiles" on-tap="_onAddFilesClick">
          <slot name="add-button">
            <paper-button id="addButton" disabled$="[[maxFilesReached]]">
              [[_i18nPlural(maxFiles, i18n.addFiles, i18n.addFiles.*)]]
            </paper-button>
          </slot>
        </div>
        <div id="dropLabel" hidden$="[[nodrop]]">
          <slot name="drop-label-icon">
            <iron-icon id="dropLabelIcon" icon="vaadin-upload:file-upload"></iron-icon>
          </slot>
          <slot name="drop-label">
            [[_i18nPlural(maxFiles, i18n.dropFiles, i18n.dropFiles.*)]]
          </slot>
        </div>
      </div>
    </div>
    <slot name="file-list">
      <div id="fileList">
        <template is="dom-repeat" items="[[files]]" as="file">
          <vaadin-upload-file file="[[file]]"></vaadin-upload-file>
        </template>
      </div>
    </slot>
    <slot></slot>
    <input type="file" id="fileInput" on-change="_onFileInputChange" hidden="" accept$="{{accept}}" multiple$="[[_isMultiple(maxFiles)]]">
    <paper-ripple id="dragRipple" noink=""></paper-ripple>
  </template>
</dom-module>

<script>

  Polymer({

    is: 'vaadin-upload',

    properties: {
      /**
       * Define whether the element supports dropping files on it for uploading.
       * By default it's enabled in desktop and disabled in touch devices
       * because mobile devices do not support drag events in general. Setting
       * it false means that drop is enabled even in touch-devices, and true
       * disables drop in all devices.
       *
       * @default true in touch-devices, false otherwise.
       */
      nodrop: {
        type: Boolean,
        reflectToAttribute: true,
        value: function() {
          try {
            return !!document.createEvent('TouchEvent');
          } catch (e) {
            return false;
          }
        }
      },

      /**
       * The server URL. The default value is an empty string, which means that
       * _window.location_ will be used.
       */
      target: {
        type: String,
        value: ''
      },

      /**
       * HTTP Method used to send the files. Only POST and PUT are allowed.
       */
      method: {
        type: String,
        value: 'POST'
      },

      /**
       * Key-Value map to send to the server. If you set this property as an
       * attribute, use a valid JSON string, for example:
       * ```
       * <vaadin-upload headers='{"X-Foo": "Bar"}'></vaadin-upload>
       * ```
       */
      headers: {
        type: Object,
        value: {}
      },

      /**
       * Max time in milliseconds for the entire upload process, if exceeded the
       * request will be aborted. Zero means that there is no timeout.
       *
       */
      timeout: {
        type: Number,
        value: 0
      },

      _dragover: {
        type: Boolean,
        value: false,
        observer: '_dragoverChanged'
      },

      /**
       * The array of files being processed, or already uploaded.
       *
       * Each element is a [`File`](https://developer.mozilla.org/en-US/docs/Web/API/File)
       * object with a number of extra properties  to track the upload process:
       * - `uploadTarget`: The target URL used to upload this file.
       * - `elapsed`: Elapsed time since the upload started.
       * - `elapsedStr`: Human-readable elapsed time.
       * - `remaining`: Number of seconds remaining for the upload to finish.
       * - `remainingStr`: Human-readable remaining time for the upload to finish.
       * - `progress`: Percentage of the file already uploaded.
       * - `speed`: Upload speed in kB/s.
       * - `size`: File size in bytes.
       * - `totalStr`: Human-readable total size of the file.
       * - `loaded`: Bytes transferred so far.
       * - `loadedStr`: Human-readable uploaded size at the moment.
       * - `status`: Status of the upload process.
       * - `error`: Error message in case the upload failed.
       * - `abort`: True if the file was canceled by the user.
       * - `complete`: True when the file was transferred to the server.
       * - `uploading`: True while trasferring data to the server.
       */
      files: {
        type: Array,
        notify: true,
        value: function() {
          return [];
        }
      },

      /**
       * Limit of files to upload, by default it is unlimited. If the value is
       * set to one, native file browser will prevent selecting multiple files.
       */
      maxFiles: {
        type: Number,
        value: Infinity
      },

      /**
       * Specifies if the maximum number of files have been uploaded
       */
      maxFilesReached: {
        type: Boolean,
        value: false,
        notify: true,
        readOnly: true,
        computed: '_maxFilesAdded(maxFiles, files.length)'
      },

      /**
       * Specifies the types of files that the server accepts.
       * Syntax: a comma-separated list of MIME type patterns (wildcards are
       * allowed) or file extensions.
       * Notice that MIME types are widely supported, while file extensions
       * are only implemented in certain browsers, so avoid using it.
       * Example: accept="video/*,image/tiff" or accept=".pdf,audio/mp3"
       */
      accept: {
        type: String,
        value: ''
      },

      /**
       * Specifies the maximum file size in bytes allowed to upload.
       * Notice that it is a client-side constraint, which will be checked before
       * sending the request. Obviously you need to do the same validation in
       * the server-side and be sure that they are aligned.
       */
      maxFileSize: {
        type: Number,
        value: Infinity
      },

      /**
       * Specifies if the dragover is validated with maxFiles and
       * accept properties.
       */
      _dragoverValid: {
        type: Boolean,
        value: false,
        observer: '_dragoverValidChanged'
      },

      /**
       * Specifies the 'name' property at Content-Disposition
       */
      formDataName: {
        type: String,
        value: 'file'
      },

      /**
       * Prevents upload(s) from immediately uploading upon adding file(s).
       * When set, you must manually trigger uploads using the `uploadFiles` method
       */
      noAuto: {
        type: Boolean,
        value: false
      },

      /**
       * The object used to localize this component.
       * For changing the default localization, change the entire
       * _i18n_ object or just the property you want to modify.
       *
       * The object has the following JSON structure and default values:

    {
      dropFiles: {
       one: 'Drop file here...',
       many: 'Drop files here...'
      },
      addFiles: {
       one: 'Select File',
       many: 'Upload Files'
      },
      cancel: 'Cancel',
      error: {
       tooManyFiles: 'Too Many Files.',
       fileIsTooBig: 'File is Too Big.',
       incorrectFileType: 'Incorrect File Type.'
      },
      uploading: {
       status: {
         connecting: 'Connecting...',
         stalled: 'Stalled.',
         processing: 'Processing File...',
         held: 'Queued'
       },
       remainingTime: {
         prefix: 'remaining time: ',
         unknown: 'unknown remaining time'
       },
       error: {
         serverUnavailable: 'Server Unavailable',
         unexpectedServerError: 'Unexpected Server Error',
         forbidden: 'Forbidden'
       }
      },
      units: {
       size: ['B', 'kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']
      },
      formatSize: function(bytes) {
       // returns the size followed by the best suitable unit
      },
      formatTime: function(seconds, [secs, mins, hours]) {
       // returns a 'HH:MM:SS' string
      }
    }

       *
       * @default {English}
       */
      i18n: {
        type: Object,
        value: function() {
          return {
            dropFiles: {
              one: 'Drop file here...',
              many: 'Drop files here...'
            },
            addFiles: {
              one: 'Select File',
              many: 'Upload Files'
            },
            cancel: 'Cancel',
            error: {
              tooManyFiles: 'Too Many Files.',
              fileIsTooBig: 'File is Too Big.',
              incorrectFileType: 'Incorrect File Type.'
            },
            uploading: {
              status: {
                connecting: 'Connecting...',
                stalled: 'Stalled.',
                processing: 'Processing File...',
                held: 'Queued'
              },
              remainingTime: {
                prefix: 'remaining time: ',
                unknown: 'unknown remaining time'
              },
              error: {
                serverUnavailable: 'Server Unavailable',
                unexpectedServerError: 'Unexpected Server Error',
                forbidden: 'Forbidden'
              }
            },
            units: {
              size: ['B', 'kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']
            }
          };
        }
      }
    },

    listeners: {
      'dragover': '_onDragover',
      'dragleave': '_onDragleave',
      'drop': '_onDrop',
      'file-retry': '_onFileRetry',
      'file-abort': '_onFileAbort',
      'file-remove': '_onFileRemove'
    },

    _formatSize: function(bytes) {
      if (typeof this.i18n.formatSize === 'function') {
        return this.i18n.formatSize(bytes);
      }

      // https://wiki.ubuntu.com/UnitsPolicy
      var base = this.i18n.units.sizeBase || 1000;
      var unit = ~~(Math.log(bytes) / Math.log(base));
      var dec = Math.max(0, Math.min(3, unit - 1));
      var size = parseFloat((bytes / Math.pow(base, unit)).toFixed(dec));
      return size + ' ' + this.i18n.units.size[unit];
    },

    _splitTimeByUnits: function(time) {
      var unitSizes = [60, 60, 24, Infinity];
      var timeValues = [0];

      for (var i = 0; i < unitSizes.length && time > 0; i++) {
        timeValues[i] = time % unitSizes[i];
        time = Math.floor(time / unitSizes[i]);
      }

      return timeValues;
    },

    _formatTime: function(seconds, split) {
      if (typeof this.i18n.formatTime === 'function') {
        return this.i18n.formatTime(seconds, split);
      }

      // Fill HH:MM:SS with leading zeros
      while (split.length < 3) {
        split.push(0);
      }

      return split
          .reverse()
          .map(function(number) {
            return (number < 10 ? '0' : '') + number;
          })
          .join(':');
    },

    _formatFileProgress: function(file) {
      return file.totalStr + ': ' +
          file.progress + '% (' +
          (file.loaded > 0 ?
              this.i18n.uploading.remainingTime.prefix + file.remainingStr :
              this.i18n.uploading.remainingTime.unknown) +
          ')';
    },

    _maxFilesAdded: function(maxFiles, numFiles) {
      return maxFiles >= 0 && numFiles >= maxFiles;
    },

    _dragRippleAction: function(action, event) {
      var rippleActionEvent = {
        detail: {
          x: event.clientX,
          y: event.clientY
        }
      };

      if (action == 'down') {
        this.$.dragRipple.downAction(rippleActionEvent);

        // paper-ripple currently has hard Ripple.MAX_RADIUS limit of 300, and
        // doesnt expose Ripple constructor or any other means to modify the
        // limit. Monkey-patching the radius calculation of just added Ripple
        // instance to disable the radius limit.
        //
        // Also fixes the default radius animation formula, which otherwise
        // tends to make the duration too small for large ripples that we have.
        //
        // FIXME: Remove this when the paper-ripple rewrite would be merged.
        // Issue: https://github.com/vaadin/vaadin-upload/issues/24
        //
        // See:
        // - https://github.com/PolymerElements/paper-ripple/issues/27
        // - https://github.com/PolymerElements/paper-ripple/pull/63
        //
        var lastRipple = this.$.dragRipple.ripples[this.$.dragRipple.ripples.length - 1];
        if (!lastRipple.hasOwnProperty('radius')) {
          Object.defineProperty(lastRipple, 'radius', {
            get: function() {
              var width2 = this.containerMetrics.width * this.containerMetrics.width;
              var height2 = this.containerMetrics.height * this.containerMetrics.height;
              var waveRadius = Math.sqrt(width2 + height2) * 1.1 + 5;

              var duration = 0.9 + 0.2 * (waveRadius / 300);
              var timeNow = this.mouseInteractionSeconds / duration;
              var size = waveRadius * (1 - Math.pow(80, -timeNow));
              return Math.abs(size);
            }
          });
        }
      } else {
        this.$.dragRipple.upAction(rippleActionEvent);
      }
    },

    _onDragover: function(event) {
      event.preventDefault();
      if (!this.nodrop && !this._dragover) {
        this._dragoverValid = !this.maxFilesReached;
        if (this._dragoverValid) {
          this._dragRippleAction('down', event);
        }
        this._dragover = true;
      }
      event.dataTransfer.dropEffect = !this._dragoverValid || this.nodrop ? 'none' : 'copy';
    },

    _onDragleave: function(event) {
      // Dragleave sometimes fired on children, skipping them. Fixes flickeing
      // when quickly dragging over.
      if (Polymer.dom(event).rootTarget === this) {
        event.preventDefault();
        if (this._dragover && !this.nodrop) {
          this._dragRippleAction('up', event);
          this._dragover = this._dragoverValid = false;
        }
      }
    },

    _onDrop: function(event) {
      if (!this.nodrop) {
        event.preventDefault();
        this._dragRippleAction('up', event);
        this._dragover = this._dragoverValid = false;
        this._dragRippleAction('upAction', event);
        this._addFiles(event.dataTransfer.files);
      }
    },

    // Override for tests
    _createXhr: function() {
      return new XMLHttpRequest();
    },

    _configureXhr: function(xhr) {
      if (typeof this.headers == 'string') {
        try {
          this.headers = JSON.parse(this.headers);
        } catch (e) {
          this.headers = undefined;
        }
      }
      for (var key in this.headers) {
        xhr.setRequestHeader(key, this.headers[key]);
      }
      if (this.timeout) {
        xhr.timeout = this.timeout;
      }
    },

    _setStatus: function(file, total, loaded, elapsed) {
      file.elapsed = elapsed;
      file.elapsedStr = this._formatTime(file.elapsed, this._splitTimeByUnits(file.elapsed));
      file.remaining = Math.ceil(elapsed * (total / loaded - 1));
      file.remainingStr = this._formatTime(file.remaining, this._splitTimeByUnits(file.remaining));
      file.speed = ~~(total / elapsed / 1024);
      file.totalStr = this._formatSize(total);
      file.loadedStr = this._formatSize(loaded);
      file.status = this._formatFileProgress(file);
    },

    /**
     * Triggers the upload of any files that are not completed
     *
     * @param {Array} [files] - Files being uploaded. Defaults to all outstanding files
     */
    uploadFiles: function(files) {
      files = files || this.files;
      files = files.filter(function(file) {
        return !file.complete;
      });
      Array.prototype.forEach.call(files, this._uploadFile.bind(this));
    },

    _uploadFile: function(file) {
      if (file.uploading) {
        return;
      }

      var ini = Date.now();
      var xhr = file.xhr = this._createXhr(file);

      var stalledId, last;
      // onprogress is called always after onreadystatechange
      xhr.upload.onprogress = function(e) {
        clearTimeout(stalledId);

        last = Date.now();
        var elapsed = (last - ini) / 1000;
        var loaded = e.loaded, total = e.total, progress = ~~(loaded / total * 100);

        file.loaded = loaded;
        file.progress = progress;
        file.indeterminate = loaded <= 0 || loaded >= total;

        if (file.error) {
          file.indeterminate = file.status = undefined;
        } else if (!file.abort) {
          if (progress < 100) {
            this._setStatus(file, total, loaded, elapsed);
            stalledId = setTimeout(function() {
              file.status = this.i18n.uploading.status.stalled;
              this._notifyFileChanges(file);
            }.bind(this), 2000);
          } else {
            file.loadedStr = file.totalStr;
            file.status = this.i18n.uploading.status.processing;
            file.uploading = false;
          }
        }

        this._notifyFileChanges(file);
        this.fire('upload-progress', {file: file, xhr: xhr});
      }.bind(this);

      // More reliable than xhr.onload
      xhr.onreadystatechange = function() {
        if (xhr.readyState == 4) {
          clearTimeout(stalledId);
          file.indeterminate = file.uploading = false;
          if (file.abort) {
            this._notifyFileChanges(file);
            return;
          }
          file.status = '';
          // Custom listener can modify the default behavior either
          // preventing default, changing the xhr, or setting the file error
          var evt = this.fire('upload-response', {file: file, xhr: xhr}, {cancelable: true});
          if (evt.defaultPrevented) {
            return;
          }
          if (xhr.status === 0) {
            file.error = this.i18n.uploading.error.serverUnavailable;
          } else if (xhr.status >= 500) {
            file.error = this.i18n.uploading.error.unexpectedServerError;
          } else if (xhr.status >= 400) {
            file.error = this.i18n.uploading.error.forbidden;
          }

          file.complete = !file.error;
          this.fire('upload-' + (file.error ? 'error' : 'success'), {file: file, xhr: xhr});
          this._notifyFileChanges(file);
        }
      }.bind(this);

      var formData = new FormData();

      file.uploadTarget = this.target || '';
      file.formDataName = this.formDataName;
      var evt = this.fire('upload-before', {file: file, xhr: xhr}, {cancelable: true});
      if (evt.defaultPrevented) {
        return;
      }

      formData.append(file.formDataName, file, file.name);

      xhr.open(this.method, file.uploadTarget, true);
      this._configureXhr(xhr);

      file.status = this.i18n.uploading.status.connecting;
      file.uploading = file.indeterminate = true;
      file.complete = file.abort = file.error = false;

      xhr.upload.onloadstart = function() {
        this.fire('upload-start', {file: file, xhr: xhr});
        this._notifyFileChanges(file);
      }.bind(this);

      // Custom listener could modify the xhr just before sending it
      // preventing default
      evt = this.fire('upload-request', {file: file, xhr: xhr, formData: formData}, {cancelable: true});
      if (!evt.defaultPrevented) {
        xhr.send(formData);
      }
    },

    _retryFileUpload: function(file) {
      var evt = this.fire('upload-retry', {file: file, xhr: file.xhr}, {cancelable: true});
      if (!evt.defaultPrevented) {
        this.async(this._uploadFile.bind(this, file));
      }
    },

    _abortFileUpload: function(file) {
      var evt = this.fire('upload-abort', {file: file, xhr: file.xhr}, {cancelable: true});
      if (!evt.defaultPrevented) {
        file.abort = true;
        if (file.xhr) {
          file.xhr.abort();
        }
        this._notifyFileChanges(file);
      }
    },

    _notifyFileChanges: function(file) {
      var p = 'files.' + this.files.indexOf(file) + '.';
      for (var i in file) {
        if (file.hasOwnProperty(i)) {
          this.notifyPath(p + i, file[i]);
        }
      }
    },

    _addFiles: function(files) {
      Array.prototype.forEach.call(files, this._addFile.bind(this));
    },

    /**
     * Add the file for uploading. Called internally for each file after picking files from dialog or dropping files.
     *
     * @param {File} file File being added
     */
    _addFile: function(file) {
      if (this.maxFilesReached) {
        this.fire('file-reject', {file: file, error: this.i18n.error.tooManyFiles});
        return;
      }
      if (this.maxFileSize >= 0 && file.size > this.maxFileSize) {
        this.fire('file-reject', {file: file, error: this.i18n.error.fileIsTooBig});
        return;
      }
      var fileExt = file.name.match(/\.[^\.]*$|$/)[0];
      var re = new RegExp('^(' + this.accept.replace(/[, ]+/g, '|').replace(/\/\*/g, '/.*') + ')$', 'i');
      if (this.accept && !(re.test(file.type) || re.test(fileExt))) {
        this.fire('file-reject', {file: file, error: this.i18n.error.incorrectFileType});
        return;
      }
      file.loaded = 0;
      file.status = this.i18n.uploading.status.held;
      this.unshift('files', file);

      if (!this.noAuto) {
        this._uploadFile(file);
      }
    },

    /**
     * Remove file from upload list. Called internally if file upload was canceled.
     * @param {File} file File to remove
     */
    _removeFile: function(file) {
      this.splice('files', this.files.indexOf(file), 1);
    },

    _onAddFilesClick: function() {
      if (this.maxFilesReached) {
        return;
      }

      if (Polymer.Gestures.resetMouseCanceller) {
        /*
          With Polymer v1.7.1, the ghost-click prevention cancels the synthetic
          file input click in iOS Safari. This prevents the cancelling.

          See also: https://github.com/Polymer/polymer/issues/4242
        */
        Polymer.Gestures.resetMouseCanceller();
      }

      this.$.fileInput.value = '';
      this.$.fileInput.click();
    },

    _onFileInputChange: function(event) {
      this._addFiles(event.target.files);
    },

    _onFileRetry: function(event) {
      this._retryFileUpload(event.detail.file);
    },

    _onFileAbort: function(event) {
      this._abortFileUpload(event.detail.file);
    },

    _onFileRemove: function(event) {
      event.stopPropagation();
      this._removeFile(event.detail.file);
    },

    _dragoverChanged: function(dragover) {
      this.toggleAttribute('dragover', dragover);
    },

    _dragoverValidChanged: function(dragoverValid) {
      this.toggleAttribute('dragover-valid', dragoverValid);
    },

    _i18nPlural: function(value, plural) {
      return value == 1 ? plural.one : plural.many;
    },

    _isMultiple: function() {
      return this.maxFiles != 1;
    }
  });

  /**
   * Fired when a file cannot be added to the queue due to a constrain:
   *  file-size, file-type or maxFiles
   *
   * @event file-reject
   * @param {Object} detail
   * @param {Object} detail.file the file added
   * @param {Object} detail.error the cause
   */

  /**
   * Fired before the XHR is opened. Could be used for changing the request
   * URL. If the default is prevented, then XHR would not be opened.
   *
   * @event upload-before
   * @param {Object} detail
   * @param {Object} detail.xhr the xhr
   * @param {Object} detail.file the file being uploaded
   * @param {Object} detail.file.uploadTarget the upload request URL, initialized with the value of vaadin-upload `target` property
   */

  /**
   * Fired when the XHR has been opened but not sent yet. Useful for appending
   * data keys to the FormData object, for changing some parameters like
   * headers, etc. If the event is preventDefault, `vaadin-upload` will not
   * send the request allowing the user to do something on his own.
   *
   * @event upload-request
   * @param {Object} detail
   * @param {Object} detail.xhr the xhr
   * @param {Object} detail.file the file being uploaded
   * @param {Object} detail.formData the FormData object
   */

  /**
   * Fired when the XHR is sent.
   *
   * @event upload-start
   * @param {Object} detail
   * @param {Object} detail.xhr the xhr
   * @param {Object} detail.file the file being uploaded
   */

  /**
   * Fired as many times as the progress is updated.
   *
   * @event upload-progress
   * @param {Object} detail
   * @param {Object} detail.xhr the xhr
   * @param {Object} detail.file the file being uploaded with loaded info
   */

  /**
   * Fired when we have the actual server response, and before the component
   * analyses it. It's useful for developers to make the upload fail depending
   * on the server response. If the event is preventDefault the vaadin-upload
   * will return allowing the user to do something on his own like retry the
   * upload, etc. since he has full access to the `xhr` and `file` objects.
   * Otherwise, if the event is not prevented default `vaadin-upload` continues
   * with the normal workflow checking the `xhr.status` and `file.error`
   * which also might be modified by the user to force a customised response.
   *
   * @event upload-response
   * @param {Object} detail
   * @param {Object} detail.xhr the xhr
   * @param {Object} detail.file the file being uploaded
   */

  /**
   * Fired in case the upload process succeed.
   *
   * @event upload-success
   * @param {Object} detail
   * @param {Object} detail.xhr the xhr
   * @param {Object} detail.file the file being uploaded with loaded info
   */

  /**
   * Fired in case the upload process failed.
   *
   * @event upload-error
   * @param {Object} detail
   * @param {Object} detail.xhr the xhr
   * @param {Object} detail.file the file being uploaded
   */

  /**
   * Fired when retry upload is requested. If the default is prevented, then
   * retry would not be performed.
   *
   * @event upload-retry
   * @param {Object} detail
   * @param {Object} detail.xhr the previous upload xhr
   * @param {Object} detail.file the file being uploaded
   */

  /**
   * Fired when retry abort is requested. If the default is prevented, then the
   * file upload would not be aborted.
   *
   * @event upload-abort
   * @param {Object} detail
   * @param {Object} detail.xhr the xhr
   * @param {Object} detail.file the file being uploaded
   */

</script>
<link rel="import" href="retro-time.html"></div><dom-module id="app-management-view">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;

        --paper-input-container-input: {
          font-size: 1em;
        };
      }

      h1 {
        margin: 16px 0 0 24px;
        padding: 0 16px;
      }
      h2 {
        margin-top: 0;
      }
      retro-time {
        font-size: 0.8em;
      }

      .app-table {
        margin-top: 20px;
      }
      .app-table th,
      .app-table td  {
        padding: 5px;
        text-align: left;
        background-color: #EEE;
      }

      .action-buttons {
        margin-top: 20px;
      }

      #newAuthor {
        display: none;
      }
      #newAuthor[orig-author-id$="-1"] {
        display: block;
      }

      #addEditAppCard[show$="addEdit"],
      #listAppsCard[show$="list"], 
      #addEditDiskImagesCard[show$="assets"],
      #addEditScreenshotsCard[show$="assets"],
      #addEditDiskImagesButtonPanel[show$="assets"] {
        display: block;
      }
      #addEditAppCard,
      #listAppsCard,
      #addEditDiskImagesCard,
      #addEditScreenshotsCard,
      #addEditDiskImagesButtonPanel {
        display: none;
      }
      #addEditDiskImagesButtonPanel {
        text-align:right;
      }

      #server-response[success$="true"] {
        background: #AFA;
      }
      #server-response[success$="false"] {
        background: #FAA;
      }
      #server-response[success$="none"] {
        display: none;
      }
      #server-response {
        margin: 20px 0;
        padding: 1em;
        display: width: 100%;
      }

      #addEditAppConfigCard {
        background-color: #F4F4F4;
      }
      .disk-image-table td {
        padding: 10px;
      }

    </style>

    <h1>App management</h1>

      <div id="addEditAppCard" show$="{{showMode}}" class="card">
      <h2>Add/Edit app</h2>

      <div id="addEditAppMetaCard" class="card">
        <h3>App metadata</h3>
        <paper-input name="appId" label="App ID" value="{{form_appId}}" hidden=""></paper-input>
        <paper-input name="appName" label="App name" value="{{form_appName}}" required=""></paper-input>
        <paper-input name="appVersion" label="App version" value="{{form_appVersion}}" required=""></paper-input>
        <paper-input name="description" label="Description" value="{{form_description}}" required=""></paper-input>
        <paper-dropdown-menu name="origAuthor" label="Original Author" required="">
          <paper-listbox slot="dropdown-content" selected="{{form_origAuthorId}}" attr-for-selected="value">
            <paper-item value="-1">Other (Enter below)</paper-item>
            <template is="dom-repeat" items="{{formData.existingAppAuthors}}">
              <paper-item value="{{item.value}}">{{item.name}}</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu><br>
        <paper-input id="newAuthor" name="newAuthor" label="New author" value="{{form_newAuthor}}" orig-author-id$="{{form_origAuthorId}}" required=""></paper-input>
        <paper-dropdown-menu name="category" label="Category" required="">
          <paper-listbox slot="dropdown-content" selected="{{form_category}}" attr-for-selected="value">
            <template is="dom-repeat" items="{{formData.appListingCategories}}">
              <paper-item value="{{item.value}}">{{item.name}}</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu><br>
      </div>

      <div id="addEditAppConfigCard" class="card">
        <h3>Configuration details (TRS 80)</h3>
        <paper-dropdown-menu name="model" label="Model" required="">
          <paper-listbox slot="dropdown-content" selected="{{form_model}}" attr-for-selected="value">
            <template is="dom-repeat" items="{{formData.trsModels}}">
              <paper-item value="{{item.value}}">{{item.name}}</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu><br>
        <paper-dropdown-menu name="kbLayoutLand" label="Landscape keyboard layout" required="">
          <paper-listbox slot="dropdown-content" selected="{{form_kbLayoutLand}}" attr-for-selected="value">
            <template is="dom-repeat" items="{{formData.keyboardLayouts}}">
              <paper-item value="{{item.value}}">{{item.name}}</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu><br>
        <paper-dropdown-menu name="kbLayoutPort" label="Portrait keyboard layout" required="">
          <paper-listbox slot="dropdown-content" selected="{{form_kbLayoutPort}}" attr-for-selected="value">
            <template is="dom-repeat" items="{{formData.keyboardLayouts}}">
              <paper-item value="{{item.value}}">{{item.name}}</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu><br>
        <paper-dropdown-menu name="charColor" label="Character color" required="">
          <paper-listbox slot="dropdown-content" selected="{{form_charColor}}" attr-for-selected="value">
            <template is="dom-repeat" items="{{formData.characterColors}}">
              <paper-item value="{{item.value}}">{{item.name}}</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu><br>
        <paper-checkbox name="soundMuted" checked="{{form_soundMuted}}">Mute sound</paper-checkbox>
      </div>

      <div class="action-buttons">
        <div id="server-response" success$="{{addEditSuccess}}">{{addEditXhrResponse.message}}</div>
        <paper-button on-tap="onSaveApp" class="action-edit">Save changes</paper-button>
        <paper-button on-tap="onCancelAddEdit" class="action-cancel">Cancel</paper-button>
      </div>
    </div>

    <div id="addEditDiskImagesButtonPanel" class="card" show$="{{showMode}}">
      <paper-button on-tap="onBackToAppList" class="action">Back to app list</paper-button>
    </div>
    <div id="addEditDiskImagesCard" class="card" show$="{{showMode}}">
      <h3>Disk images (TRS 80)</h3>
      <table class="disk-image-table">
      <tbody><tr>
        <th>Disk Image</th>
        <th>Uploaded</th>
        <th>Size</th>
        <th>Upload</th>
        <th>Delete</th>
      </tr>
      <template is="dom-repeat" items="{{diskImages}}">
        <tr>
          <td>{{item.label}}</td>
          <td><retro-time millis="{{item.uploadTime}}"></retro-time></td>
          <td>{{item.sizeInBytes}}</td>
          <td><paper-button on-tap="onUploadDiskImage" class="action-edit">Upload</paper-button></td>
          <td><paper-button on-tap="onDeleteDiskImage" class="action-delete">Delete</paper-button></td>
        </tr>
      </template>
      </tbody></table>
    </div>

    <div id="addEditScreenshotsCard" class="card" show$="{{showMode}}">
      <h3>Screenshots</h3>
      <table class="disk-image-table">
      <tbody><tr>
        <th>Screenshot</th>
        <th>Size (TODO: Preview)</th>
        <th>Upload</th>
        <th>Delete</th>
      </tr>
      <template is="dom-repeat" items="{{screenshots}}">
        <tr>
          <td>{{item.id}}</td>
          <td>{{item.sizeInBytes}}</td>
          <td><paper-button on-tap="onUploadDiskImage" class="action-edit">Upload</paper-button></td>
          <td><paper-button on-tap="onDeleteDiskImage" class="action-delete">Delete</paper-button></td>
        </tr>
      </template>
      </tbody></table>
    </div>

    <paper-dialog id="uploadDialog" on-iron-overlay-opened="_patchOverlay" modal="">
      <p>{{model_dialog_text}}</p>
      <vaadin-upload id="fileUpload" target="/post/uploadDiskImage/{{assets_appId}}/{{upload_item.id}}" max-files="1" method="POST" maxfilesize="10000000">
        <iron-icon slot="drop-label-icon" icon="cloud-upload"></iron-icon>
        <span slot="drop-label">{{upload_item.label}}</span>
      </vaadin-upload>
      <div class="buttons">
        <paper-button id="cancelUpload" dialog-confirm="" autofocus="">Cancel</paper-button>
      </div>
    </paper-dialog>

    <div id="listAppsCard" show$="{{showMode}}" class="card">
      <div class="action-bar&quot;" style="float: right">
        <paper-button on-click="onAddApp" raised="" class="action">Add app</paper-button>
      </div>
      <h2>App list</h2>
      <table class="app-table">
      <tbody><tr>
        <th>Name</th>
        <th>Publisher</th>
        <th>Version</th>
        <th>First uploaded</th>
        <th>Last updated</th>
        <th>Edit</th>
        <th>Assets</th>
        <!--<th>Publish</th>-->
        <th>Delete</th>
      </tr>
      <template is="dom-repeat" items="{{ajaxResponse}}">
        <tr>
          <td>{{item.listing.name}}</td>
          <td>{{item.listing.publisherEmail}}</td>
          <td>{{item.listing.versionString}}</td>
          <td><retro-time millis="{{item.listing.firstPublishTime}}"></retro-time></td>
          <td><retro-time millis="{{item.listing.lastUpdateTime}}"></retro-time></td>
          <td><paper-button on-tap="onEditApp" class="action-edit">Edit</paper-button></td>
          <td><paper-button on-tap="onAssetsApp" class="action-edit">Assets</paper-button></td>
          <!--<td><paper-button on-tap="onEditApp" class="action-edit">Publish/Unpublish</paper-button></td>-->
          <td><paper-button on-tap="onDeleteApp" class="action-delete">Delete</paper-button></td>
        </tr>
      </template>
      </tbody></table>
    </div>
    <iron-ajax auto="" id="xhrFormData" url="/rpc?m=getAppFormData" handle-as="json" debounce-duration="300" last-response="{{formData}}"></iron-ajax>
    <iron-ajax auto="" id="xhrAppList" url="/rpc?m=applist" handle-as="json" debounce-duration="300" last-response="{{ajaxResponse}}"></iron-ajax>
    <iron-ajax id="xhrAddEditApp" url="/rpc?m=addEditApp" method="POST" handle-as="json" on-response="onAddEditResponse" content-type="application/json" last-response="{{addEditXhrResponse}}"></iron-ajax>
    <iron-ajax id="xhrDeleteApp" url="/rpc?m=deleteApp" method="POST" handle-as="json" on-response="onDeleteResponse" content-type="application/json" last-response="{{deleteXhrResponse}}"></iron-ajax>
    <iron-ajax id="xhrListDiskImages" noauto="" url="/rpc?m=listDiskImages&amp;appId={{requestDiskImagesAppId}}" handle-as="json" debounce-duration="300" last-response="{{diskImages}}"></iron-ajax>
  </template>

  <script>
    class AppManagementView extends Polymer.Element {
      static get is() { return 'app-management-view'; }

      ready() {
        super.ready();
        this.showMode = "list";
        this.clearForm();
        this.diskImages = [];

        var thiz = this;
        this.$.uploadDialog.addEventListener('upload-start', function(e) {
          thiz.$.cancelUpload.disabled = true;
        });
        this.$.uploadDialog.addEventListener('upload-response', function(e) {
          thiz.$.xhrListDiskImages.generateRequest();
          thiz.$.cancelUpload.disabled = false;
          thiz.$.fileUpload.files = [];
          thiz.$.uploadDialog.close();
        });
      }

      onBackToAppList() {
        this.$.xhrAppList.generateRequest();
        this.showMode = "list";
      }
      onAddApp() {
        this.clearForm();
        this.showMode = "addEdit";
      }
      onAssetsApp(e) {
        this.clearForm();
        this.assets_appId = e.model.get("item.id");
        this.showMode = "assets";
        this.requestDiskImagesAppId = this.assets_appId;
        this.$.xhrListDiskImages.generateRequest();
      }
      onEditApp(e) {
        this.clearForm();
        this.form_appId = e.model.get('item.id');
        this.form_appName = e.model.get('item.listing.name');
        this.form_appVersion = e.model.get('item.listing.versionString');
        this.form_description = e.model.get('item.listing.description');
        this.form_origAuthorId = e.model.get('item.listing.authorId');
        this.form_newAuthor = "";
        this.form_category = e.model.get('item.listing.categories')[0];
        this.form_model = e.model.get('item.configuration.model');
        this.form_kbLayoutLand = e.model.get('item.configuration.kbLayoutLandscape');
        this.form_kbLayoutPort = e.model.get('item.configuration.kbLayoutPortrait');
        this.form_charColor = e.model.get('item.configuration.charColor');
        this.form_soundMuted = e.model.get('item.configuration.soundMuted');

        this.showMode = "addEdit";
      }
      onDeleteApp(e) {
        var idStr = e.model.get('item.id');
        var name = e.model.get('item.listing.name');
        if (confirm(`Are you sure you want to delete ${name} (${idStr})?`)) {
          var data = { id: idStr };
          this.$.xhrDeleteApp.body = JSON.stringify(data);
          this.$.xhrDeleteApp.generateRequest();
        } else {
          // Do nothing.
        }
      }
      onSaveApp() {
        var data = {
          appId: this.form_appId,
          appName: this.form_appName,
          appVersion: this.form_appVersion,
          description: this.form_description,
          origAuthorId: this.form_origAuthorId,
          newAuthor: this.form_newAuthor,
          category: this.form_category,
          model: this.form_model,
          kbLayoutLand: this.form_kbLayoutLand,
          kbLayoutPort: this.form_kbLayoutPort,
          charColor: this.form_charColor,
          soundMuted: this.form_soundMuted
        };

        this.$.xhrAddEditApp.body = JSON.stringify(data);
        this.$.xhrAddEditApp.generateRequest();
      }
      onCancelAddEdit() {
        onBackToAppList();
      }
      onAddEditResponse() {
        this.addEditSuccess = "" + this.addEditXhrResponse.success;
        if (this.addEditXhrResponse.success) {
          onBackToAppList();

          // We might get new author data, if the user added one.
          this.$.xhrFormData.generateRequest();
        }
      }
      onDeleteResponse() {
        if (!this.deleteXhrResponse.success) {
          alert("Delete failed: " + this.deleteXhrResponse.message);
        } else {
          this.$.xhrAppList.generateRequest(); 
        }
      }
      onUploadDiskImage(e) {
        this.upload_item = e.model.get("item");
        this.$.uploadDialog.open();
      }
      clearForm() {
        this.addEditSuccess = "none";
        this.form_appId = "";
        this.form_appName = "";
        this.form_appVersion = "";
        this.form_description = "";
        this.form_origAuthorId = "-1";
        this.form_newAuthor = "";

        if (!!this.formData) {
          this.form_category = this.formData.appListingCategories[0].value;
          this.form_model = this.formData.trsModels[0].value;
          this.form_kbLayoutLand = this.formData.keyboardLayouts[0].value;
          this.form_kbLayoutPort = this.formData.keyboardLayouts[0].value;
          this.form_charColor = this.formData.characterColors[0].value;
        }
        this.form_soundMuted = false;
      }
      _patchOverlay(e) {
        // See bug: https://github.com/PolymerElements/paper-dialog/issues/7
        if (e.target.withBackdrop) {
          e.target.parentNode.insertBefore(e.target.backdropElement, e.target);
        }
      }
    }
    window.customElements.define(AppManagementView.is, AppManagementView);
  </script>
</dom-module>
